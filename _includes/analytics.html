<!-- Google Analytics 4 -->
<!-- Replace GA_MEASUREMENT_ID with your actual GA4 measurement ID -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GA_MEASUREMENT_ID', {
    'anonymize_ip': true,
    'cookie_flags': 'SameSite=None;Secure',
    'link_attribution': true,
    'allow_google_signals': true,
    'transport_type': 'beacon',
    'page_path': window.location.pathname,
    'page_title': document.title
  });

  // Enhanced Ecommerce - Track form submissions
  document.addEventListener('DOMContentLoaded', function() {
    // Track contact form submissions
    const contactForms = document.querySelectorAll('form[action*="contact"], .contact-form');
    contactForms.forEach(function(form) {
      form.addEventListener('submit', function() {
        gtag('event', 'generate_lead', {
          'event_category': 'engagement',
          'event_label': 'Contact Form Submission',
          'value': 1
        });
      });
    });

    // Track phone number clicks
    const phoneLinks = document.querySelectorAll('a[href^="tel:"]');
    phoneLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        gtag('event', 'click', {
          'event_category': 'engagement',
          'event_label': 'Phone Call',
          'value': link.getAttribute('href')
        });
      });
    });

    // Track email clicks
    const emailLinks = document.querySelectorAll('a[href^="mailto:"]');
    emailLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        gtag('event', 'click', {
          'event_category': 'engagement',
          'event_label': 'Email Click',
          'value': link.getAttribute('href')
        });
      });
    });

    // Track PDF downloads
    const pdfLinks = document.querySelectorAll('a[href$=".pdf"]');
    pdfLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        gtag('event', 'file_download', {
          'event_category': 'engagement',
          'event_label': 'PDF Download',
          'file_name': link.getAttribute('href')
        });
      });
    });

    // Track outbound links
    const outboundLinks = document.querySelectorAll('a[href^="http"]:not([href*="' + window.location.hostname + '"])');
    outboundLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        gtag('event', 'click', {
          'event_category': 'outbound',
          'event_label': link.getAttribute('href'),
          'transport_type': 'beacon'
        });
      });
    });

    // Track scroll depth
    let scrollDepths = [25, 50, 75, 90];
    let scrolled = [];
    
    window.addEventListener('scroll', function() {
      let scrollPercent = (window.scrollY + window.innerHeight) / document.body.offsetHeight * 100;
      
      scrollDepths.forEach(function(depth) {
        if (scrollPercent >= depth && !scrolled.includes(depth)) {
          scrolled.push(depth);
          gtag('event', 'scroll', {
            'event_category': 'engagement',
            'event_label': 'Scroll Depth',
            'value': depth
          });
        }
      });
    });

    // Track time on page
    let startTime = Date.now();
    window.addEventListener('beforeunload', function() {
      let timeOnPage = Math.round((Date.now() - startTime) / 1000);
      gtag('event', 'timing_complete', {
        'name': 'time_on_page',
        'value': timeOnPage,
        'event_category': 'engagement'
      });
    });
  });
</script>

<!-- Structured Data for Search Enhancement -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "url": "https://skerritteconomics.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "https://skerritteconomics.com/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
}
</script>