<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, viewport-fit=cover">
<title>{% if page.title %}{{ page.title }} | {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
<meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
<!-- Inline Critical CSS -->
<style>
/* Critical CSS for above-the-fold content */
:root{--primary-color:#1e3a8a;--secondary-color:#3730a3;--accent-color:#dc2626;--dark-text:#1f2937;--light-text:#6b7280;--background:#ffffff;--light-bg:#f9fafb;--border-color:#e5e7eb;--success:#059669;--max-width:1200px;--transition-fast:0.2s ease;--transition-normal:0.3s ease}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;line-height:1.6;color:var(--dark-text);background-color:var(--background)}
.container{max-width:var(--max-width);margin:0 auto;padding:0 20px}
.main-nav{background:var(--background);box-shadow:0 1px 3px rgba(0,0,0,0.1);position:sticky;top:0;z-index:1000}
.nav-wrapper{display:flex;justify-content:space-between;align-items:center;padding:1rem 0}
.logo{font-size:1.25rem;color:var(--dark-text);display:flex;flex-direction:column;line-height:1.2}
.nav-menu{display:flex;list-style:none;align-items:center;gap:2rem}
.hero{background:linear-gradient(135deg,var(--primary-color) 0%,var(--secondary-color) 100%);color:white;padding:5rem 0}
.hero h1{font-size:2.5rem;font-weight:700;margin-bottom:1.5rem;line-height:1.2}
.hero-subtitle{font-size:1.25rem;margin-bottom:2rem;opacity:0.95;line-height:1.5}
.btn{display:inline-block;padding:0.875rem 1.75rem;border-radius:6px;font-weight:600;text-align:center;transition:all 0.3s ease;font-size:1rem;cursor:pointer}
.btn-primary{background:white;color:var(--primary-color)}
.mobile-menu-toggle{display:none}
@media (max-width:768px){
.mobile-menu-toggle{display:flex;flex-direction:column;gap:4px;background:none;border:none;cursor:pointer;padding:0.5rem}
.nav-menu{position:fixed;left:-100%;top:0;flex-direction:column;background-color:white;width:85%;max-width:350px;height:100vh}
.hero h1{font-size:2rem;line-height:1.2}
.hero-subtitle{font-size:1.125rem}
}
</style>

<!-- Load full CSS asynchronously -->
<link rel="preload" href="{{ '/css/styles.min.css?v=8' | relative_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ '/css/styles.min.css?v=8' | relative_url }}"></noscript>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Critical font-display CSS to prevent FOIT -->
<style>
    @font-face {
        font-family: 'Inter';
        font-style: normal;
        font-weight: 300 700;
        font-display: swap;
        src: local('Inter'), local('Inter-Regular');
    }
    
    /* Fallback font stack while Inter loads */
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
</style>

<!-- Optimized font loading with fallback -->
<script>
    (function() {
        // Web Font Loader approach
        if ('fonts' in document) {
            // Modern browsers - use CSS Font Loading API
            var font = new FontFace('Inter', 'url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7.woff2) format("woff2")', {
                weight: '300 700',
                display: 'swap'
            });
            
            font.load().then(function(loadedFont) {
                document.fonts.add(loadedFont);
                document.documentElement.classList.add('fonts-loaded');
            }).catch(function() {
                // Fallback to link element
                loadFontsViaLink();
            });
        } else {
            // Older browsers - use link element
            loadFontsViaLink();
        }
        
        function loadFontsViaLink() {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap';
            link.media = 'print';
            link.onload = function() { 
                this.media = 'all'; 
                document.documentElement.classList.add('fonts-loaded');
            };
            document.head.appendChild(link);
        }
    })();
</script>
<noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"></noscript>
{% seo %}

<!-- Google Analytics 4 - Optimized Loading -->
<script>
    // Minimal GA initialization
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    
    // Track phone clicks
    function trackPhoneClick() {
        if (typeof gtag !== 'undefined') {
            gtag('event', 'phone_call', {
                'event_category': 'engagement',
                'event_label': 'phone_number_click'
            });
        }
    }
    
    // Track email clicks
    function trackEmailClick() {
        if (typeof gtag !== 'undefined') {
            gtag('event', 'email_click', {
                'event_category': 'engagement',
                'event_label': 'email_address_click'
            });
        }
    }
    
    // Track form submissions
    function trackFormSubmission(formType) {
        if (typeof gtag !== 'undefined') {
            gtag('event', 'form_submission', {
                'event_category': 'conversion',
                'event_label': formType
            });
        }
    }
    
    // Delay GA loading until after page load or user interaction
    let gaLoaded = false;
    function loadGoogleAnalytics() {
        if (!gaLoaded) {
            gaLoaded = true;
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-JNK2QCYSC7';
            script.onload = function() {
                gtag('js', new Date());
                gtag('config', 'G-JNK2QCYSC7', {
                    'custom_map': {'custom_parameter_1': 'consultation_requests'}
                });
            };
            document.head.appendChild(script);
        }
    }
    
    // Load GA on user interaction or after 3 seconds
    if ('requestIdleCallback' in window) {
        requestIdleCallback(loadGoogleAnalytics, { timeout: 3000 });
    } else {
        setTimeout(loadGoogleAnalytics, 3000);
    }
    
    // Also load on first user interaction
    ['click', 'scroll', 'touchstart'].forEach(event => {
        window.addEventListener(event, loadGoogleAnalytics, { once: true, passive: true });
    });
</script>

<!-- Structured Data -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "ProfessionalService",
    "name": "{{ site.title }}",
    "description": "{{ site.description }}",
    "url": "{{ site.url }}",
    "telephone": "{{ site.phone }}",
    "address": {
        "@type": "PostalAddress",
        "streetAddress": "{{ site.address }}",
        "addressLocality": "Smithfield",
        "addressRegion": "RI",
        "addressCountry": "US"
    },
    "areaServed": ["Rhode Island", "Massachusetts", "Connecticut", "New Hampshire", "Vermont", "Maine"],
    "priceRange": "$$$$"
}
</script>

<!-- FAQ Schema - Include if page has FAQs -->
{% include faq-schema.html %}