{% comment %}
  Optimized Image Component with SEO-friendly attributes
  Usage: {% include optimized-image.html src="/path/to/image.jpg" alt="Description" title="Title" %}
  
  Parameters:
  - src: Image source path (required)
  - alt: Alt text for accessibility and SEO (required)
  - title: Title attribute (optional, defaults to alt)
  - class: CSS classes (optional)
  - loading: Loading attribute (optional, defaults to "lazy")
  - width: Image width (optional)
  - height: Image height (optional)
{% endcomment %}

{% assign image_src = include.src | relative_url %}
{% assign image_alt = include.alt | default: page.title | escape %}
{% assign image_title = include.title | default: image_alt %}
{% assign image_class = include.class | default: "optimized-image" %}
{% assign image_loading = include.loading | default: "lazy" %}

{% comment %} Generate multiple image sizes for responsive loading {% endcomment %}
{% assign image_extension = image_src | split: '.' | last %}
{% assign image_base = image_src | remove: image_extension | remove: '.' %}

<picture class="{{ image_class }}-wrapper">
  {% comment %} WebP format for modern browsers {% endcomment %}
  {% if image_extension != 'svg' %}
    <source 
      type="image/webp"
      srcset="{{ image_base }}-400w.webp 400w,
              {{ image_base }}-800w.webp 800w,
              {{ image_base }}-1200w.webp 1200w"
      sizes="(max-width: 400px) 400px,
             (max-width: 800px) 800px,
             1200px">
  {% endif %}
  
  {% comment %} Original format fallback {% endcomment %}
  <img 
    src="{{ image_src }}"
    alt="{{ image_alt }}"
    title="{{ image_title }}"
    class="{{ image_class }}"
    loading="{{ image_loading }}"
    {% if include.width %}width="{{ include.width }}"{% endif %}
    {% if include.height %}height="{{ include.height }}"{% endif %}
    {% if image_extension != 'svg' %}
      srcset="{{ image_base }}-400w.{{ image_extension }} 400w,
              {{ image_base }}-800w.{{ image_extension }} 800w,
              {{ image_base }}-1200w.{{ image_extension }} 1200w"
      sizes="(max-width: 400px) 400px,
             (max-width: 800px) 800px,
             1200px"
    {% endif %}
    onerror="this.onerror=null; this.src='{{ '/assets/images/placeholder.jpg' | relative_url }}';"
  >
</picture>

{% comment %} Add structured data for images {% endcomment %}
{% if include.caption %}
<figure class="{{ image_class }}-figure">
  <figcaption>{{ include.caption }}</figcaption>
</figure>
{% endif %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ImageObject",
  "contentUrl": "{{ image_src | absolute_url }}",
  "name": "{{ image_title }}",
  "description": "{{ image_alt }}",
  {% if include.caption %}"caption": "{{ include.caption }}",{% endif %}
  "uploadDate": "{{ site.time | date_to_xmlschema }}"
}
</script>

<style>
.optimized-image-wrapper {
  display: block;
  max-width: 100%;
  height: auto;
}

.optimized-image {
  max-width: 100%;
  height: auto;
  display: block;
}

.optimized-image-figure {
  margin: 1rem 0;
}

.optimized-image-figure figcaption {
  font-size: 0.875rem;
  color: #6b7280;
  text-align: center;
  margin-top: 0.5rem;
}
</style>